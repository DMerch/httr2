<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wrapping APIs • httr2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Wrapping APIs">
<meta property="og:description" content="httr2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">httr2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/httr2.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/wrapping-apis.html">Wrapping APIs</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/r-lib/httr2/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="wrapping-apis_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Wrapping APIs</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-lib/httr2/blob/master/vignettes/wrapping-apis.Rmd"><code>vignettes/wrapping-apis.Rmd</code></a></small>
      <div class="hidden name"><code>wrapping-apis.Rmd</code></div>

    </div>

    
    
<p>A common use for httr2 is wrapping up a useful API and exposing it in an R package: you want to take an API endpoint (i.e. a URL with parameters) and wrap it up into an R function where each endpoint parameter corresponds to a documented function argument. This vignette will show you how, starting with a very simple API that doesn’t need authentication, and working our way up in complexity.</p>
<p>Along the way, you’ll learn about how to:</p>
<ul>
<li><p>Ensure that HTTP errors expose as much detail in the R error.</p></li>
<li><p>Wrap up details of authentication to provide a user friendly experience.</p></li>
<li><p>Consistently throttle the rate of requests or dynamically respond to rate limiting headers sent by the server.</p></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://httr2.r-lib.org">httr2</a></span><span class="op">)</span></code></pre></div>
<div id="basics" class="section level2">
<h2 class="hasAnchor">
<a href="#basics" class="anchor"></a>Basics</h2>
<p>We’ll start with a very simple API, <a href="https://fakerapi.it/en" class="uri">faker API</a>, which provides a collection of techniques for generating fake data. Before we start writing the sort of functions that you might put in a package, we’ll perform a request just to see how the basics work:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># We start by creating a request that uses the base API url</span>
<span class="va">req</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/request.html">request</a></span><span class="op">(</span><span class="st">"https://fakerapi.it/api/v1"</span><span class="op">)</span>
<span class="va">resp</span> <span class="op">&lt;-</span> <span class="va">req</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="co"># Then we add on the images path</span>
  <span class="fu"><a href="../reference/req_url.html">req_url_path_append</a></span><span class="op">(</span><span class="st">"images"</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="co"># Add set _width and _quantity query parameters</span>
  <span class="fu"><a href="../reference/req_url.html">req_url_query</a></span><span class="op">(</span>`_width` <span class="op">=</span> <span class="fl">380</span>, `_quantity` <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/req_perform.html">req_perform</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># The result comes back as JSON</span>
<span class="va">resp</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="fu"><a href="../reference/resp_body_raw.html">resp_body_json</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; List of 4</span>
<span class="co">#&gt;  $ status: chr "OK"</span>
<span class="co">#&gt;  $ code  : int 200</span>
<span class="co">#&gt;  $ total : int 1</span>
<span class="co">#&gt;  $ data  :List of 1</span>
<span class="co">#&gt;   ..$ :List of 3</span>
<span class="co">#&gt;   .. ..$ title      : chr "Et fugit vero illum."</span>
<span class="co">#&gt;   .. ..$ description: chr "Nihil sunt occaecati illum. Velit illo est aut velit. Quis accusantium aut nesciunt dolor doloremque."</span>
<span class="co">#&gt;   .. ..$ url        : chr "http://placeimg.com/380/480/any"</span></code></pre></div>
<div id="errors" class="section level3">
<h3 class="hasAnchor">
<a href="#errors" class="anchor"></a>Errors</h3>
<p>Next it’s worth a little experimentation to see if we get any useful information from errors. If you fetch a URL that returns an unsuccesful HTTP response, you’ll get an error so you can’t further inspect the body:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">req</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/req_url.html">req_url_path_append</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/req_perform.html">req_perform</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Error: HTTP 404 Not Found.</span></code></pre></div>
<p>To see what’s going on, you’ll need to use <code><a href="../reference/req_error.html">req_error()</a></code> to turn off the default behaviour that turns HTTP errors into R errors:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">resp</span> <span class="op">&lt;-</span> <span class="va">req</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/req_url.html">req_url_path_append</a></span><span class="op">(</span><span class="st">"imagesasf"</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/req_error.html">req_error</a></span><span class="op">(</span>is_error <span class="op">=</span> <span class="op">~</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/req_perform.html">req_perform</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Now you can look at the response body:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">resp</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="fu"><a href="../reference/resp_body_raw.html">resp_body_json</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; $status</span>
<span class="co">#&gt; [1] "Not found"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $code</span>
<span class="co">#&gt; [1] 404</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $total</span>
<span class="co">#&gt; [1] 0</span></code></pre></div>
<p>It doesn’t look like there’s anything useful there so I’ll double check the headers:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">resp</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="fu"><a href="../reference/resp_headers.html">resp_headers</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Server: nginx</span>
<span class="co">#&gt; Content-Type: application/json</span>
<span class="co">#&gt; Transfer-Encoding: chunked</span>
<span class="co">#&gt; Connection: keep-alive</span>
<span class="co">#&gt; Vary: Accept-Encoding</span>
<span class="co">#&gt; X-Powered-By: PHP/7.3.16</span>
<span class="co">#&gt; Cache-Control: no-cache, private</span>
<span class="co">#&gt; Date: Wed, 23 Jun 2021 02:18:37 GMT</span>
<span class="co">#&gt; Access-Control-Allow-Origin: *</span>
<span class="co">#&gt; Access-Control-Allow-Methods: GET</span>
<span class="co">#&gt; Access-Control-Allow-Credentials: true</span>
<span class="co">#&gt; Access-Control-Max-Age: 86400</span>
<span class="co">#&gt; Access-Control-Allow-Headers: Content-Type, Authorization, X-Requested-With</span>
<span class="co">#&gt; Content-Encoding: gzip</span></code></pre></div>
<p>It doesn’t look like we’re getting any more useful information, so we can leave the default as is. We’ll have another go later with an API that does provide more details.</p>
</div>
<div id="making-a-function" class="section level3">
<h3 class="hasAnchor">
<a href="#making-a-function" class="anchor"></a>Making a function</h3>
<p>Once you’ve got the basics, you can wrap it up into a function. You’ll need to decide if you want to returning a request or perform the request and return the result. The first gives you more flexibility, but the user will need to add two more calls; the second is easier but less flexible.</p>
<p>Use defaults. Automatically add underscores.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">req_faker</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">resource</span>, <span class="va">...</span>, <span class="va">quantity</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">locale</span> <span class="op">=</span> <span class="st">"en_US"</span>, <span class="va">seed</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="va">...</span>,
    quantity <span class="op">=</span> <span class="va">quantity</span>,
    locale <span class="op">=</span> <span class="va">locale</span>,
    seed <span class="op">=</span> <span class="va">seed</span>
  <span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span><span class="op">)</span>
  
  <span class="fu"><a href="../reference/request.html">request</a></span><span class="op">(</span><span class="st">"https://fakerapi.it/api/v1"</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
    <span class="fu"><a href="../reference/req_url.html">req_url_path_append</a></span><span class="op">(</span><span class="va">resource</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
    <span class="fu"><a href="../reference/req_url.html">req_url_query</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">params</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
    <span class="fu"><a href="../reference/req_perform.html">req_perform</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
    <span class="fu"><a href="../reference/resp_body_raw.html">resp_body_json</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu">req_faker</span><span class="op">(</span><span class="st">"images"</span>, width <span class="op">=</span> <span class="fl">300</span><span class="op">)</span>
<span class="co">#&gt; $status</span>
<span class="co">#&gt; [1] "OK"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $code</span>
<span class="co">#&gt; [1] 200</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $total</span>
<span class="co">#&gt; [1] 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $data</span>
<span class="co">#&gt; $data[[1]]</span>
<span class="co">#&gt; $data[[1]]$title</span>
<span class="co">#&gt; [1] "Quasi iusto quia sed."</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $data[[1]]$description</span>
<span class="co">#&gt; [1] "Sint rem aperiam labore. Quibusdam qui eos consectetur porro minima est consectetur. Et nostrum at sed cupiditate sit unde. Dolor cumque odio non dolorum accusantium debitis perspiciatis."</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $data[[1]]$url</span>
<span class="co">#&gt; [1] "http://placeimg.com/300/480/any"</span></code></pre></div>
<p>There’s only one trick to notice here — <code><a href="../reference/req_url.html">req_url_query()</a></code> uses dynamic dots, so we can use <code>!!!</code> to convert (e.g.) <code>req_url_query(req, !!!list(`_quantity` = 1, `_locale` = "en_US")</code> into <code>req_url_query(req, `_quantity` = 1, `_locale` = "en_US")</code>.</p>
<p>In most cases, this function will be for internal use only, as you’ll continue to make a function for each endpoint useful to the R programmer. In some cases, you might want to export this function sot that the experienced user can call endpoints that you haven’t yet wrapped.</p>
<p>To make the app more convenient for R users, you might continue by adding functions that convert the nested list into a data frame. I’d suggest keeping that code in a separate function since it’s likely to vary by endpoint.</p>
</div>
<div id="user-agent" class="section level3">
<h3 class="hasAnchor">
<a href="#user-agent" class="anchor"></a>User agent</h3>
<p>Before we go on, Polite to set a user agent — <a href="https://github.com/r-lib/httr2/issues/43" class="uri">https://github.com/r-lib/httr2/issues/43</a>.</p>
</div>
</div>
<div id="app-with-api-key" class="section level2">
<h2 class="hasAnchor">
<a href="#app-with-api-key" class="anchor"></a>App with API key</h2>
<p>Next we’ll take a look at the NYTimes <a href="https://developer.nytimes.com/docs/books-product/1/overview">Books API</a>. It requires a very simple authentication — you include the API key in the query of every request. I don’t want to share my API key with the whole world so I’ve encrypted it with <code><a href="../reference/secrets.html">secret_encrypt()</a></code> and I’ll decrypt it for this vignette with <code><a href="../reference/secrets.html">secret_decrypt()</a></code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_key</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/secrets.html">secret_decrypt</a></span><span class="op">(</span><span class="st">"hbYctm6bwp7_V37UFOAX-7uel5QN4cRWzoQpGCqCk9I"</span>, <span class="st">"HTTR2_KEY"</span><span class="op">)</span></code></pre></div>
<p>The encryption and decryption relies on a key stored in the <code>HTTR2_KEY</code> environment variable. This is set up on my computer and on GitHub actions where this vignette is often run, but it won’t be available on your computer or on CRAN. In the source of this vignette I store whether or not it’s available in <code>nyt_ok &lt;- secret_has_key("HTTR2_KEY")</code>, and then use <code>eval = nyt_ok</code> in each chunk so that the code is only run when possible.</p>
<p>This allows now allows us to perform a test request and look at the response:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">resp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/request.html">request</a></span><span class="op">(</span><span class="st">"https://api.nytimes.com/svc/books/v3"</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/req_url.html">req_url_path_append</a></span><span class="op">(</span><span class="st">"/reviews.json"</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/req_url.html">req_url_query</a></span><span class="op">(</span>`api-key` <span class="op">=</span> <span class="va">my_key</span>, isbn <span class="op">=</span> <span class="fl">9780307476463</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/req_perform.html">req_perform</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">resp</span></code></pre></div>
<p>Like most modern APIs, this one returns the results as JSON:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">resp</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/resp_body_raw.html">resp_body_json</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Before we start wrapping this up into a function lets explore what happens with errors.</p>
<div id="security-considerations" class="section level3">
<h3 class="hasAnchor">
<a href="#security-considerations" class="anchor"></a>Security considerations</h3>
<p>Note that including an API key in a query is a relatively insecure method; if an API uses it its typically because the key is relatively easy to create or gives relatively few privileges. Section 5.3 of <a href="https://datatracker.ietf.org/doc/html/rfc6750#section-5.3">rfc6750</a> has this to say about passing bearer tokens<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> in the URL:</p>
<blockquote>
<p><strong>Don’t pass bearer tokens in page URLs</strong>: Bearer tokens SHOULD NOT be passed in page URLs (for example, as query string parameters). Instead, bearer tokens SHOULD be passed in HTTP message headers or message bodies for which confidentiality measures are taken. Browsers, web servers, and other software may not adequately secure URLs in the browser history, web server logs, and other data structures. If bearer tokens are passed in page URLs, attackers might be able to steal them from the history data, logs, or other unsecured locations.</p>
</blockquote>
<p>httr2 makes no efforts to redact confidential information stored in query parameters. This means it’s relatively easy to leak your key if you use <code>req_perform(verbose = 1)</code> or <code><a href="../reference/req_dry_run.html">req_dry_run()</a></code>. This just means you’ll need to be a little cautious if you need to get help with a reprex; you’ll need to manually redact the key.</p>
</div>
<div id="error-handling" class="section level3">
<h3 class="hasAnchor">
<a href="#error-handling" class="anchor"></a>Error handling</h3>
<p>What happens if there’s an error? For example, if we deliberately supply an invalid key:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">resp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/request.html">request</a></span><span class="op">(</span><span class="st">"https://api.nytimes.com/svc/books/v3"</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/req_url.html">req_url_path_append</a></span><span class="op">(</span><span class="st">"/reviews.json"</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/req_url.html">req_url_query</a></span><span class="op">(</span>`api-key` <span class="op">=</span> <span class="st">"invalid"</span>, isbn <span class="op">=</span> <span class="fl">9780307476463</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/req_perform.html">req_perform</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>To see if there’s any extra useful information we can again suppress the default error and inspect the result:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">resp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/request.html">request</a></span><span class="op">(</span><span class="st">"https://api.nytimes.com/svc/books/v3"</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/req_url.html">req_url_path_append</a></span><span class="op">(</span><span class="st">"/reviews.json"</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/req_url.html">req_url_query</a></span><span class="op">(</span>`api-key` <span class="op">=</span> <span class="st">"invalid"</span>, isbn <span class="op">=</span> <span class="fl">9780307476463</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/req_error.html">req_error</a></span><span class="op">(</span>is_error <span class="op">=</span> <span class="op">~</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/req_perform.html">req_perform</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">resp</span>
<span class="va">resp</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="fu"><a href="../reference/resp_body_raw.html">resp_body_json</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>It looks like there’s some useful additional info in the <code>faultstring</code>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">resp</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="fu"><a href="../reference/resp_body_raw.html">resp_body_json</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="va">.</span><span class="op">$</span><span class="va">fault</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="va">.</span><span class="op">$</span><span class="va">faultstring</span></code></pre></div>
<p>To add that information to future errors we can use the <code>info</code> argument to <code><a href="../reference/req_error.html">req_error()</a></code>. Once we do that and re-fetch the request, we see the additional information displayed in the R error:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">resp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/request.html">request</a></span><span class="op">(</span><span class="st">"https://api.nytimes.com/svc/books/v3"</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/req_url.html">req_url_path_append</a></span><span class="op">(</span><span class="st">"/reviews.json"</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/req_url.html">req_url_query</a></span><span class="op">(</span>`api-key` <span class="op">=</span> <span class="st">"invalid"</span>, isbn <span class="op">=</span> <span class="fl">9780307476463</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/req_error.html">req_error</a></span><span class="op">(</span>info <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">resp</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">resp</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="fu"><a href="../reference/resp_body_raw.html">resp_body_json</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="va">.</span><span class="op">$</span><span class="va">fault</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="va">.</span><span class="op">$</span><span class="va">faultstring</span>
  <span class="op">}</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/req_perform.html">req_perform</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="rate-limits" class="section level3">
<h3 class="hasAnchor">
<a href="#rate-limits" class="anchor"></a>Rate limits</h3>
<p>The <a href="https://developer.nytimes.com/faq#a11">frequently asked questions</a> also mentions rate limits:</p>
<blockquote>
<p>Yes, there are two rate limits per API: 4,000 requests per day and 10 requests per minute. You should sleep 6 seconds between calls to avoid hitting the per minute rate limit. If you need a higher rate limit, please contact us at <a href="mailto:code@nytimes.com" class="email">code@nytimes.com</a>.</p>
</blockquote>
<p>Since the docs don’t mention that the use of <code>Retry-After</code> header, we’ll use <code><a href="../reference/req_throttle.html">req_throttle()</a></code> to ensure we don’t make more than 10 requests every 60s:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">req</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/request.html">request</a></span><span class="op">(</span><span class="st">"https://api.nytimes.com/svc/books/v3"</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/req_url.html">req_url_path_append</a></span><span class="op">(</span><span class="st">"/reviews.json"</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/req_url.html">req_url_query</a></span><span class="op">(</span>`api-key` <span class="op">=</span> <span class="st">"invalid"</span>, isbn <span class="op">=</span> <span class="fl">9780307476463</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/req_throttle.html">req_throttle</a></span><span class="op">(</span><span class="fl">10</span> <span class="op">/</span> <span class="fl">60</span><span class="op">)</span></code></pre></div>
<p>This limit is automatically shared across all requests made to <code>api.nytimes.com</code>. Since the docs suggest the rate limit applies per API, you might want to use the <code>realm</code> argument to be a bit more specific:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">req</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/request.html">request</a></span><span class="op">(</span><span class="st">"https://api.nytimes.com/svc/books/v3"</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/req_url.html">req_url_path_append</a></span><span class="op">(</span><span class="st">"/reviews.json"</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/req_url.html">req_url_query</a></span><span class="op">(</span>`api-key` <span class="op">=</span> <span class="st">"invalid"</span>, isbn <span class="op">=</span> <span class="fl">9780307476463</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/req_throttle.html">req_throttle</a></span><span class="op">(</span><span class="fl">10</span> <span class="op">/</span> <span class="fl">60</span>, realm <span class="op">=</span> <span class="st">"https://api.nytimes.com/svc/books"</span><span class="op">)</span></code></pre></div>
<p>Many APIs return additional information about how long to wait when the rate limit is exceeded. So I deliberately violated the rate limit by quickly making 11 requests; unfortunately while the response was a standard 429 (Too many requests), it did not include any information about how long to wait in either the response body or the headers.</p>
</div>
<div id="wrapping-it-up" class="section level3">
<h3 class="hasAnchor">
<a href="#wrapping-it-up" class="anchor"></a>Wrapping it up</h3>
<p>Putting together all the pieces above yields a function something like this:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nytimes_books</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">api_key</span>, <span class="va">path</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="../reference/request.html">request</a></span><span class="op">(</span><span class="st">"https://api.nytimes.com/svc/books/v3"</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
    <span class="fu"><a href="../reference/req_url.html">req_url_path_append</a></span><span class="op">(</span><span class="st">"/reviews.json"</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
    <span class="fu"><a href="../reference/req_url.html">req_url_query</a></span><span class="op">(</span><span class="va">...</span>, `api-key` <span class="op">=</span> <span class="va">api_key</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
    <span class="fu"><a href="../reference/req_error.html">req_error</a></span><span class="op">(</span>info <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">resp</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">resp</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="fu"><a href="../reference/resp_body_raw.html">resp_body_json</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="va">.</span><span class="op">$</span><span class="va">fault</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="va">.</span><span class="op">$</span><span class="va">faultstring</span>
    <span class="op">}</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
    <span class="fu"><a href="../reference/req_throttle.html">req_throttle</a></span><span class="op">(</span><span class="fl">10</span> <span class="op">/</span> <span class="fl">60</span>, realm <span class="op">=</span> <span class="st">"https://api.nytimes.com/svc/books"</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
    <span class="fu"><a href="../reference/req_perform.html">req_perform</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
    <span class="fu"><a href="../reference/resp_body_raw.html">resp_body_json</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">drunk</span> <span class="op">&lt;-</span> <span class="fu">nytimes_books</span><span class="op">(</span><span class="va">my_key</span>, <span class="st">"/reviews.json"</span>, isbn <span class="op">=</span> <span class="st">"0316453382"</span><span class="op">)</span>
<span class="va">drunk</span><span class="op">$</span><span class="va">results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">summary</span></code></pre></div>
<p>Again, for a real package, you’d want to spend some time converting the nested list into a more user friendly data structure.</p>
</div>
<div id="api-key" class="section level3">
<h3 class="hasAnchor">
<a href="#api-key" class="anchor"></a>API key</h3>
<p>If you were going to put this into a package, you’d need to think about some convenient interface for supplying the API key. An environment variable is a good place to start because they’re easy to set without typing anything in the console (which can get accidentally shared via your <code>.Rhistory</code>) and are easily set in automated processes.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">get_api_key</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">key</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">"NYTIMES_KEY"</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">key</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"No API key found, please supply with `api_key` argument or with NYTIMES_KEY env var"</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">key</span>
<span class="op">}</span>

<span class="va">req_nytimes_books</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">path</span>, <span class="va">...</span>, <span class="va">api_key</span> <span class="op">=</span> <span class="fu">get_api_key</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">...</span>
<span class="op">}</span></code></pre></div>
<p>Since the <code>api_key</code> is no longer required, we can make it the last argument to the function. It’s still available to override and document, but it’ll only be needed in exceptional circumstances.</p>
</div>
</div>
<div id="sending-data-http-methods" class="section level2">
<h2 class="hasAnchor">
<a href="#sending-data-http-methods" class="anchor"></a>Sending data &amp; HTTP methods</h2>
<p><a href="https://docs.github.com/en/rest/reference/gists#star-a-gist" class="uri">https://docs.github.com/en/rest/reference/gists#star-a-gist</a></p>
<p>Just use basic auth: <a href="https://docs.github.com/en/rest/overview/other-authentication-methods#basic-authentication" class="uri">https://docs.github.com/en/rest/overview/other-authentication-methods#basic-authentication</a> username + token. Good example of why tokens: you can have many different tokens, each which can do different things, and can be revoked without affecting any other token or requiring you to change your password.</p>
<p>Need to be a little careful with tokens in env vars. Any R package could use. But this doesn’t really pose any additional threat: an R package can run any code, so it’s already very powerful. If you are worried about this attack vector you need to resolve it by ensuring that the process that runs R is locked down (e.g. run in a container or other VM).</p>
<p>Rate limiting: <a href="https://docs.github.com/en/rest/overview/resources-in-the-rest-api#rate-limiting" class="uri">https://docs.github.com/en/rest/overview/resources-in-the-rest-api#rate-limiting</a></p>
</div>
<div id="app-that-uses-oauth" class="section level2">
<h2 class="hasAnchor">
<a href="#app-that-uses-oauth" class="anchor"></a>App that uses OAuth</h2>
<p>If the API provides access to a website where the user already has an account (think twitter, instagram, facebook, google, etc), it’s likely to use OAuth to allow you app to authenticate on behalf of the user. OAuth<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> is an authentication framework that’s designed so that you don’t have to share your username and password with an app; instead the app asks for permission to use your account. You’ve almost certainly used this before on the web; it’s used in most cases where one website wants to use another website on your behalf.</p>
<div id="oauth-clients" class="section level3">
<h3 class="hasAnchor">
<a href="#oauth-clients" class="anchor"></a>OAuth clients</h3>
<p>The first step in working with any OAuth api is to create a client or app. This involves you registering for a developer account on the APIs website and creating a new OAuth app. The process varies from API to API, but at the end of it you’ll be a client id and in most cases a client secret.</p>
<p>If the API provides a way to authenticate without the client secret, you should leave it out of your package. But in most cases, you’ll need to include the secret in the package. You can use <code><a href="../reference/obfuscate.html">obfuscate()</a></code> to hide the secret; again this is not bullet proof but for most people it will be easier to create a new client than try and reuse yours. It is unusual for an OAuth client to be able to do anything in its own right, so even if someone does steal your secret there’s not much harm they can do with it (generally the worst they can do is use up your rate limits).</p>
<p>To obfuscate a secret, call <code><a href="../reference/obfuscate.html">obfuscate()</a></code>:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/obfuscate.html">obfuscate</a></span><span class="op">(</span><span class="st">"secret"</span><span class="op">)</span>
<span class="co">#&gt; obfuscated("YVW06Lex")</span></code></pre></div>
<p>Then use the client id from the website along with the obfuscated secret to create a client:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">client</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oauth_client.html">oauth_client</a></span><span class="op">(</span>
  id <span class="op">=</span> <span class="st">"client_id"</span>, 
  secret <span class="op">=</span> <span class="fu"><a href="../reference/obfuscate.html">obfuscated</a></span><span class="op">(</span><span class="st">"YVW06Lex"</span><span class="op">)</span>,
  token <span class="op">=</span> <span class="st">"https://accounts.google.com/o/oauth2/token"</span>
<span class="op">)</span>
<span class="va">client</span>
<span class="co">#&gt; &lt;httr2_oauth_client&gt;</span>
<span class="co">#&gt; name: 741ee61ebc1fc0f8fedcf12647c95cb3</span>
<span class="co">#&gt; id: client_id</span>
<span class="co">#&gt; secret: &lt;REDACTED&gt;</span>
<span class="co">#&gt; token_url: https://accounts.google.com/o/oauth2/token</span>
<span class="co">#&gt; auth: oauth_client_req_auth_body</span></code></pre></div>
<p>Note that when you print the client, httr2 automatically redacts the secret — this is part of the general effort that httr2 makes to prevent you from accidentally exposing any confidential information in logs or reprexes.</p>
</div>
<div id="oauth-app" class="section level3">
<h3 class="hasAnchor">
<a href="#oauth-app" class="anchor"></a>OAuth app</h3>
<p>Once you have a client, you’ll need to collect a little more information to create an OAuth app. An app is the combination of the information about your client and some general information about the API. (From the perspective of the API client and app are synonymous because it’s only thinking of itself).</p>
<p>The information you’ll need varies a little depending on the flow you’re using, but for the most common case it will look something like this. You’ll pass the client that you created above, as long as a list of authentication endpoints. In the most common case, you’ll need to supply <code>token</code> and <code>authorization</code> endpoints.</p>
<p>Depending on how the API is set up, you may also need to change the <code>auth</code> parameter. We’ll come back to that shortly.</p>
</div>
<div id="oauth-flows" class="section level3">
<h3 class="hasAnchor">
<a href="#oauth-flows" class="anchor"></a>OAuth flows</h3>
<p>OAuth provides a number of different “flows”. The most common is the “authorisation code” flow, which is implemented by <code><a href="../reference/req_oauth_auth_code.html">req_oauth_auth_code()</a></code>. It goes something like this:</p>
<ul>
<li><p>Client makes authorisation request to resource owner, and it returns an authorisation grant (four types are defined in this rfc: authorisation code, implicit, resource owner password credentials, and client credentials).</p></li>
<li><p>Client makes authorisation grant to authorisation server (which can be different to resource server, even though that appears to be rare in practice) which returns access token.</p></li>
<li><p>Client uses access token to access protected resources. <code><a href="../reference/req_auth_bearer_token.html">req_auth_bearer_token()</a></code></p></li>
</ul>
<p>Other flows provide different ways getting the token:</p>
<ul>
<li><p><code><a href="../reference/req_oauth_client_credentials.html">req_oauth_client_credentials()</a></code> is used to allow the client to perform actions on its own behalf (instead of on behalf of some other user).</p></li>
<li><p><code><a href="../reference/req_oauth_device.html">req_oauth_device()</a></code> uses the “device” flow which is designed for devices like TVs that don’t have an easy way to enter data. It also works well from the console.</p></li>
<li><p><code><a href="../reference/req_oauth_bearer_jwt.html">req_oauth_bearer_jwt()</a></code> uses a JWT signed by a private key.</p></li>
<li><p><code><a href="../reference/req_oauth_password.html">req_oauth_password()</a></code> exchanges a user name and password for an access token.</p></li>
<li><p><code><a href="../reference/req_oauth_refresh.html">req_oauth_refresh()</a></code> works directly with a refresh token that you’ve got elsewhere. It’s useful for testing.</p></li>
</ul>
<p>There’s one historically important OAuth flows that httr2 doesn’t support: the implicit grant flow. This is now <a href="https://developer.okta.com/blog/2019/05/01/is-the-oauth-implicit-flow-dead">mostly deprecated</a> and was never a particularly good fit for native applications because it relies on a technique for returning the access token that only works inside a web browser.</p>
<p>When wrapping an API, you’ll need to carefully read the documentation to figure out which flows are available. Typically you’ll want to use the auth code flow, but if it’s not available you’ll need to carefully consider the others.</p>
<p>An additional wrinkle is that many APIs don’t implement the flow in exactly the same way as the spec. If your initial attempt doesn’t work, you’re going to need to do some sleuthing. This is going to be moderately painful but unfortunately there’s no way around it. I recommend using <code>with_verbose()</code> so you can see exactly what httr2 is sending to the server. You’ll then need to carefully compare this to the API documentation and play spot the difference.</p>
<p>To get started, I recommend first working with the lower-level <code>oauth_flow_*()</code> functions. They just return a token (rather than authenticating a request) so they’re easy to work with as you get the system up and running.</p>
</div>
<div id="token-caching" class="section level3">
<h3 class="hasAnchor">
<a href="#token-caching" class="anchor"></a>Token caching</h3>
<p>Token caching. Many acess tokens also have a refresh token, which is a way to get new access tokens. httr2 can cache these tokens. If the token has expired and has a refresh token, we automatically refresh before the first request. If the request errors with a 401 and error <code>invalid_token</code> then we try the refresh token if available, otherwise re-run the full flow.</p>
</div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>A bearer token is a little different to an access key but the distinction isn’t important here.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Here I’ll only talk about OAuth 2.0 which is the only version in common use today. OAuth 1.0 is largely only of historical interest.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://hadley.nz">Hadley Wickham</a>, <a href="https://www.rstudio.com"><img src="https://www.tidyverse.org/rstudio-logo.svg" alt="RStudio" height="24"></a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>

<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>OAuth flow: authorization code — oauth_flow_auth_code • httr2</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="OAuth flow: authorization code — oauth_flow_auth_code" />
<meta property="og:description" content="These functions implement the OAuth authorization code flow, as defined
by rfc6749,
Section 4.1. This is the most commonly used OAuth flow where the user is
opens a page in their browser, approves the access, and then returns to R.
oauth_flow_auth_code() is a high-level wrapper that should
work with APIs that adhere relatively closely to the spec. The remaining
low-level functions can be used to assemble a custom flow for APIs that are
further from the spec:
oauth_flow_auth_code_url() generates the url where the user is sent.
oauth_flow_auth_code_listen() starts an webserver that listens for
the response from the resource server.
oauth_flow_auth_code_parse() parses the query parameters returned from
the server redirect, verifying that the state is correct, and returning
the authorisation code.
oauth_flow_auth_code_pkce() generates code verifier, method, and challenge
components as needed for PKCE, as defined in
rfc7636.

Security considerations


The authorization code flow is used for both web applications and native
applications (which are equivalent to R packages).
rfc8252 spells out
important considerations for native apps. Most importantly there's no way
for native apps to keep secrets from their users. This means that the
server should either not require a client_secret (i.e. a public client
not an confidential client) or ensure that possession of the client_secret
doesn't bestow any meaningful rights.
Only modern APIs from the bigger players (Azure, Google, etc) explicitly
native apps. However, in most cases, even for older APIs, possessing the
client_secret gives you no ability to do anything harmful, so our
general principle is that it's fine to include it in an R package, as long
as it's mildly obfuscated to protect it from credential scraping. There's
no incentive to steal your client credentials if it takes less time to
create a new client than find your client secret.
" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">httr2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/articles/oauth.html">oauth</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/r-lib/httr2/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>OAuth flow: authorization code</h1>
    <small class="dont-index">Source: <a href='https://github.com/r-lib/httr2/blob/master/R/oauth-flow-auth-code.R'><code>R/oauth-flow-auth-code.R</code></a></small>
    <div class="hidden name"><code>oauth_flow_auth_code.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>These functions implement the OAuth authorization code flow, as defined
by <a href='https://datatracker.ietf.org/doc/html/rfc6749#section-4.1'>rfc6749</a>,
Section 4.1. This is the most commonly used OAuth flow where the user is
opens a page in their browser, approves the access, and then returns to R.</p>
<p><code>oauth_flow_auth_code()</code> is a high-level wrapper that should
work with APIs that adhere relatively closely to the spec. The remaining
low-level functions can be used to assemble a custom flow for APIs that are
further from the spec:</p><ul>
<li><p><code>oauth_flow_auth_code_url()</code> generates the url where the user is sent.</p></li>
<li><p><code>oauth_flow_auth_code_listen()</code> starts an webserver that listens for
the response from the resource server.</p></li>
<li><p><code>oauth_flow_auth_code_parse()</code> parses the query parameters returned from
the server redirect, verifying that the <code>state</code> is correct, and returning
the authorisation code.</p></li>
<li><p><code>oauth_flow_auth_code_pkce()</code> generates code verifier, method, and challenge
components as needed for PKCE, as defined in
<a href='https://datatracker.ietf.org/doc/html/rfc7636'>rfc7636</a>.</p></li>
</ul>
<h3 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Security considerations</h3>


<p>The authorization code flow is used for both web applications and native
applications (which are equivalent to R packages).
<a href='https://datatracker.ietf.org/doc/html/rfc8252'>rfc8252</a> spells out
important considerations for native apps. Most importantly there's no way
for native apps to keep secrets from their users. This means that the
server should either not require a <code>client_secret</code> (i.e. a public client
not an confidential client) or ensure that possession of the <code>client_secret</code>
doesn't bestow any meaningful rights.</p>
<p>Only modern APIs from the bigger players (Azure, Google, etc) explicitly
native apps. However, in most cases, even for older APIs, possessing the
<code>client_secret</code> gives you no ability to do anything harmful, so our
general principle is that it's fine to include it in an R package, as long
as it's mildly obfuscated to protect it from credential scraping. There's
no incentive to steal your client credentials if it takes less time to
create a new client than find your client secret.</p>

    </div>

    <pre class="usage"><span class='fu'>oauth_flow_auth_code</span><span class='op'>(</span>
  <span class='va'>app</span>,
  scope <span class='op'>=</span> <span class='cn'>NULL</span>,
  pkce <span class='op'>=</span> <span class='cn'>TRUE</span>,
  auth_params <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
  token_params <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
  host_name <span class='op'>=</span> <span class='st'>"localhost"</span>,
  host_ip <span class='op'>=</span> <span class='st'>"127.0.0.1"</span>,
  port <span class='op'>=</span> <span class='fu'>httpuv</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/httpuv/man/randomPort.html'>randomPort</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='op'>)</span>

<span class='fu'>oauth_flow_auth_code_url</span><span class='op'>(</span>
  <span class='va'>app</span>,
  redirect_uri <span class='op'>=</span> <span class='cn'>NULL</span>,
  scope <span class='op'>=</span> <span class='cn'>NULL</span>,
  state <span class='op'>=</span> <span class='cn'>NULL</span>,
  auth_params <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='op'>)</span>

<span class='fu'>oauth_flow_auth_code_listen</span><span class='op'>(</span>host_ip <span class='op'>=</span> <span class='st'>"127.0.0.1"</span>, port <span class='op'>=</span> <span class='fl'>1410</span><span class='op'>)</span>

<span class='fu'>oauth_flow_auth_code_parse</span><span class='op'>(</span><span class='va'>query</span>, <span class='va'>state</span><span class='op'>)</span>

<span class='fu'>oauth_flow_auth_code_pkce</span><span class='op'>(</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>app</th>
      <td><p>An <code>oauth_app()</code>.</p></td>
    </tr>
    <tr>
      <th>scope</th>
      <td><p>Scopes to be requested from the resource owner.</p></td>
    </tr>
    <tr>
      <th>pkce</th>
      <td><p>Use "Proof Key for Code Exchange"? This adds an extra layer of
security and should always be used if supported by the server.</p></td>
    </tr>
    <tr>
      <th>auth_params</th>
      <td><p>List containing additional parameters passed to <code>oauth_flow_auth_code_url()</code></p></td>
    </tr>
    <tr>
      <th>token_params</th>
      <td><p>List containing additional parameters passed to <code>oauth_flow_access_token()</code>.</p></td>
    </tr>
    <tr>
      <th>host_name</th>
      <td><p>Host name used to generate <code>redirect_uri</code></p></td>
    </tr>
    <tr>
      <th>host_ip</th>
      <td><p>IP address web server will be bound to.</p></td>
    </tr>
    <tr>
      <th>port</th>
      <td><p>Port to bind web server to. By default, this uses a random port.
You may need to set it to a fixed port if the API requires that the
<code>redirect_uri</code> specified in the client exactly matches the <code>redirect_uri</code>
generated by this function.</p></td>
    </tr>
    <tr>
      <th>redirect_uri</th>
      <td><p>URL to which user should be redirected.</p></td>
    </tr>
    <tr>
      <th>state</th>
      <td><p>Random state generated by <code>oauth_flow_auth_code()</code>. Used to
verify that we're working with an authentication request that we created.
(This is an unlikely threat for R packages since the webserver that
listens for authorization responses is transient.)</p></td>
    </tr>
    <tr>
      <th>query</th>
      <td><p>List of query parameters returned by <code>oauth_flow_auth_code_listen()</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Other OAuth flows: 
<code><a href='oauth_flow_client_credentials.html'>oauth_flow_client_credentials</a>()</code>,
<code><a href='oauth_flow_device.html'>oauth_flow_device</a>()</code>,
<code><a href='oauth_flow_password.html'>oauth_flow_password</a>()</code>,
<code><a href='oauth_flow_refresh.html'>oauth_flow_refresh</a>()</code></p></div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by <a href='http://hadley.nz'>Hadley Wickham</a>, <a href='https://www.rstudio.com'><img src='https://www.tidyverse.org/rstudio-logo.svg' alt='RStudio' height='24' /></a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


